{% extends "base.jade" %}
{% block title %}个人信息{% endblock %}
{% block headright %}
{% endblock %}
{% block head %} 
<script type="text/javascript">
$(document).ready(function(){
    $(function () {
        $('#head-upload').fileupload({
            dataType: 'json',
            autoUpload: true,
            singleFileUploads: true,
            done: function (e, data) {
            	var obj = jQuery.parseJSON(data.jqXHR.responseText);
				$("#user-head").attr("src","/authorize/head/"+obj.photo_key);
				img_url = $('#user-head').attr("src");
				$('#user_upload_thumbnail').attr("src",img_url);
				$('input[name="img_url"]').val(img_url);
				
            },
            progressall: function (e, data) {
                var progress = parseInt(data.loaded / data.total * 100, 10);
                $('#progress .bar').css(
                    'width',
                    progress + '%'
                );
            }	
        });
        $('<div><img id="user_upload_thumbnail" src="/statics/img/picture_load.gif" style="position: relative;" /><div>')	
        .css({
            float: 'left',
            position: 'relative',
            overflow: 'hidden',
            width: '100px',
            height: '100px'
        })
        .insertAfter($('#user-head'));
	    $('#user-head').imgAreaSelect({ aspectRatio: '1:1', onSelectChange: preview,maxWidth: 120, maxHeight: 120,minWidth:120, minHeight:120,
	    	onSelectEnd: function (img, selection) {
            $('input[name="x1"]').val(selection.x1);
            $('input[name="y1"]').val(selection.y1);
            $('input[name="x2"]').val(selection.x2);
            $('input[name="y2"]').val(selection.y2);
        	}
	    });
	  
    	
    })
})	
function preview(img, selection) {
    var scaleX = 100 / (selection.width || 1);
    var scaleY = 100 / (selection.height || 1);
  	var wid=$("#user-head").width();
   	var hei=$("#user-head").height();
    $('#user-head + div > img').css({
        width: Math.round(scaleX * wid) + 'px',
        height: Math.round(scaleY * hei) + 'px',
        marginLeft: '-' + Math.round(scaleX * selection.x1) + 'px',
        marginTop: '-' + Math.round(scaleY * selection.y1) + 'px'
    });
}
</script>
<style type="text/css">
.bar {height:18px;  background:green;}
</style>
{% endblock %}
{% block content %}
<div id="mycans">
	<div id="mycans_right">
		<div class="mycans_div">
			<div class="mycans_tit">
				<h3>基本信息</h3>
			</div>
			<div id="B_i_con">
				<ul>
					{% block content_works %}{% endblock %}
					<li class="B_i_con_li1">名号：</li>
					<li class="B_i_con_li2">
						<input name="" type="text" value="{{ profile.nickname }}" class="B_i_con_input1"/>
					</li>
					<li class="B_i_con_li1">头像：</li>
					<li class="B_i_con_li2"><a class="B_i_con_lia2">本地照片</a>
						<p>支持.jpg，.png文件，且文件不能大于5M</p>
						<div style="position:relative;width:531px;height:339px;background:#eaa">
							<div style="position:relative;width:300px;height:339px;background:#eee;border:1px solid #fff;float:left">
								<div style="position:relative;width:300px;height:300px;background:#eee;border:1px solid #000;float:left">
									<img />
								</div>
								<a style="display:block;position:relative;float:left"><img src="/statics/img/turn_left.GIF" /></a>
								<a style="display:block;position:relative;float:right"><img src="/statics/img/turn_right.GIF" /></a>
							</div>
							<div style="position:relative;width:150px;height:140px;background:#eee;border:1px solid #fff;float:left;margin-left:60px;margin-top:20px;">
								<div style="position:relative;width:120px;height:120px;background:#eee;border:1px solid #000;margin:0 auto;">
									<img />
								</div>
								<p> 大头像尺寸，120*120像素</p>
							</div>
							<div style="position:relative;width:150px;height:60px;background:#eee;border:1px solid #fff;float:left;margin-left:60px;margin-top:40px;">
								<div style="position:relative;width:40px;height:40px;background:#eee;border:1px solid #000;margin:0 auto;">
									<img />
								</div>
								<p> 小头像尺寸，40*40像素</p>
							</div>
						</div>
					</li>
					<li class="B_i_con_li1">性别：</li>
					<li class="B_i_con_li2">
						<label>
							<input name="sex" type="radio" value="" checked={{ profile.gender }}/>
							<em>&nbsp;男</em></label>
						<label>
							<input name="sex" type="radio" value="" checked={{ profile.gender }}/>
							<em>&nbsp;女</em></label>
					</li>
					<li class="B_i_con_li1">所在地：</li>
					<li class="B_i_con_li2"><a class="B_i_con_lia3">省/直辖市/自治区</a><a class="B_i_con_lia3">地区/市</a></li>
					<li class="B_i_con_li1">个人简介：</li>
					<li class="B_i_con_li2">
						<textarea name="" cols="" rows="" class="B_i_textarea">{{ profile.introduction }}</textarea>
					</li>
					<li class="B_i_con_li1"></li>
					<li class="B_i_con_li2"><a class="B_i_con_btn">完&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;成</a></li>
				</ul>
			</div>
		</div>
	</div>
</div>
{% endblock %}
